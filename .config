; IMPORTANT: There always must be at least one space after the argument value, before the semicolon in front
; of the comment.



[System]

stationID: US9999
latitude: 33.580453             ; WGS84 +N (degrees)
longitude: -112.019888          ; WGS84 +E (degrees)
elevation: 415                  ; mean sea level EGM96 geoidal datum, not WGS84 ellipsoidal (meters)


cams_code: 0                    ; Should be set only if full CAMS compatibility is desired
weblog_enable: false            ; Show this camera on the GMN weblog
weblog_description: none        ; The description shown on the weblog (e.g. location, pointing direction)
network_name: ContrailCast      ; Camera network (e.g. national networks, used for grouping on the weblog).
                                ;   Separate by comma for multiple networks
camera_group_name: cochise      ; Camera group (e.g. a camera cluster or a location with multiple cameras)


external_script_run: false                  ; Enable running an external script at the end of every night
                                            ;   it will be passed three arguments:
                                            ;   captured_night_dir, archived_night_dir, config 
auto_reprocess_external_script_run: true    ; Run the external script after auto reprocess.
                                            ;   "auto_reprocess" needs to be "true" for this to work.
external_script_path: none                  ; Full path to the external script
external_function_name: rmsExternal         ; Name of the function in the external script to be called


reboot_after_processing: true       ; Reboot the computer daily after processing and upload
reboot_lock_file: .reboot_lock      ; Lock file name for preventing rebooting until the script is done
                                    ;   The external script should remove this file if the reboot is to run
                                    ;   after the script finishes. This file should be created in the
                                    ;   config.data_dir directory (i.e. ~/RMS_data).



[Capture]

device: rtsp://192.168.42.10:554/user=admin&password=&channel=1&stream=0.sdp    ; device id
media_backend: gst  ; Media backend: gst, cv2, v4l2. gst provides higher timestamp accuracy.

uyvy_pixelformat: false

width: 1920
height: 1080
fps: 24.981216                  ; frames per second
delta_t: 0.0                    ; Detla time in seconds to be added to the recorded timestamp.
                                ;   This fine tunes the frame timestamps.

report_dropped_frames: true     ; Log dropped frames. Only applicable to analog cameras

roi_left: -1                    ; Region of interest, left limit. -1 to disable
roi_right: -1                   ; Region of interest, right limit. -1 to disable
roi_up: -1                      ; Region of interest, upper limit. -1 to disable
roi_down: -1                    ; Region of interest, lower limit. -1 to disable

bit_depth: 8                    ; Bit depth of the camera (e.g. an 8-bit camera)
gamma: 1.0                      ; Gamma of the camera. Usually 0.45 or 1.0

ff_format: fits                 ; Format of files, either 'bin' (CAMS format), or 'fits' (new RMS format)


fov_w: 88.6                     ; Approx. horizontal Field-of-view in degrees
fov_h: 47.1                     ; Approx. vertical Field-of-view in degrees

deinterlace_order: -1           ; Deinterlacing:    -2 = global shutter
                                ;                   -1 = rolling shutter
                                ;                    0 = even first
                                ;                    1 = odd first

mask: mask.bmp                  ; A mask applied to images to prevent detection in the masked area
                                ; DO NOT CHANGE
                                ; Must be lovated in the same directory as the config file

data_dir: ~/RMS_data            ; Directory where all data will be stored
captured_dir: CapturedFiles     ; Directory for raw captured files
archived_dir: ArchivedFiles     ; Directory for archived files
jpg_dir: JpgFiles               ; Directory for JPEG files
log_dir: logs                   ; Directory for log files

extra_space_gb: 5               ; Extra GB space left on the SD card nightly, accounting for the predicted
                                ;   size of all FF files.

live_maxpixel_enable: false     ; Toggle showing maxpixel on the screen during capture
live_jpg: false                 ; Toggle saving a single jpg with the latest maxpixel image in the data dir.
save_jpgs: false                ; Toggle saving video frames to JPEG at a set interval to the jpg_dir
jpgs_quality: 90                ; Set JPEG compression quality for the save_jpgs feature
jpgs_interval: 125              ; Set the interval for saving video frames to JPEG. Must be greater than 5.
                                ; CAUTION: Lower intervals can generate a large amount of data.
                                ; Example: An 8-hour run at 25 FPS will generate different data sizes
                                ;          depending on the interval and resolution selected.
                                ;
                                ;          |     Interval    |    Resolution     |
                                ;          | (Frames) |  (s) |   720p  |  1080p  |
                                ;          |----------|------|---------|-------- |
                                ;          |        5 | 0.2  |  ~20 GB |  ~50 GB |
                                ;          |       25 |   1  |   ~4 GB |  ~10 GB |
                                ;          |       50 |   2  |   ~2 GB |   ~5 GB |
                                ;          |      125 |   5  | ~800 MB |   ~2 GB |
                                ;          |      250 |  10  | ~400 MB |   ~1 GB |

slideshow_enable: false         ; Toggle daytime slideshow of last night's meteor detections
auto_reprocess: true            ; Auto-reprocess broken capture directories after power cuts or crashes
capture_resume_flag_file: .capture_resuming     ; Flag file to load processed files on capture resume

capture_wait_seconds: 0         ; Additional wait time (seconds) for staggered start in multi-camera setups
capture_wait_randomize: false   ; Randomize wait time (0 to capture_wait_seconds) for multi-camera systems.

postprocess_at_end: false       ; Process detection and postprocessing at night's end, not during capture.

postprocess_delay: 0            ; Add extra seconds before starting detection: after capture begins if
                                ; postprocess_at_end is false, or after capture ends if true.



[Build]

; Compiler arguments for cython
rpi_weave: -O3 -mfpu=neon -funsafe-loop-optimizations -ftree-loop-if-convert-stores
linux_pc_weave: -O3
win_pc_weave: -Wall



[Upload]

upload_enabled: false                   ; Flag for enabling/disabling upload to meteor server
upload_delay: 0                         ; Delay upload for the given number of minutes
hostname: gmn.uwo.ca                    ; Server address
host_port: 22                           ; Standard SSH port
rsa_private_key: ~/.ssh/id_rsa          ; Path to the SSH private key.
remote_dir: files                       ; Directory on the server where the detected files will be uploaded to
upload_queue_file: FILES_TO_UPLOAD.inf  ; Name of the file where the upload queue will be stored.

; Upload mode
; -----------
; By default, RMS will upload text files with meteor and star detections, secondary data products 
;     such as calibration plots, all FF image files, and all FR files with raw fireball frames.
;     This typically results in an archive of 100-500 MB in size. Some stations have limited 
;     data or bad internet connections, so a reduced data set can be uploaded to the server.
; Options:
;     1 - Normal mode. Everything is uploaded, including FF files with detections.
;     2 - Skip FFs. Everything except two FF files will be uploaded. One with the most matched stars
;         and another random one with a meteor detection.
;     3 - Skip FFs and FRs. Same as option 2, but FR files will also be skipped.
;     4 - Skip FRs, but upload everything else.
upload_mode: 1



[Compression]



[FireballDetection]

enable_fireball_detection: false    ; Flag for enabling/disabling fireball detection
subsampling_size: 16                ; Subsample to 16x16 squares (default 16)
k1: 7.0                             ; Weight for stddev in thresholding for fireball extraction
j1: 10                              ; Absolute offset in thresholding for fireball extraction
max_time: 6                         ; Max runtime (seconds) for the line finding algorithm.
white_avg_level: 220                ; Threshold average frame level beyond which images are considered too
                                    ;   white to process
minimal_level: 40                   ; Absolute minimum brightness in order to consider a pixel (0-255)
minimum_pixels: 8                   ; How many pixels in a square to consider it as an event point (DEFAULT 8)
max_points_per_frame: 30            ; Absolute number of points per frame required for flare detection
max_per_frame_factor: 10            ; Multiplied with median number of points, used for flare detection
max_points: 500                     ; If there is more event points than this threshold, randomize them
min_frames: 6                       ; Minimum number of frames covered by event points (not just one line,
                                    ;   but all points)
min_points: 8                       ; Minimum number of event points in a line
extend_before: 0.15                 ; Percent of frames to extrapolate before a meteor trail's detected start
extend_after: 0.15                  ; Percent of frames to extrapolate after a meteor trail's detected end
min_window_size: 100                ; Absolute minimum size for extracted frame crop
max_window_size: 400                ; Absolute maximum size for extracted frame crop
threshold_for_size: 0.9             ; Threshold for dynamically determining window size
distance_threshold: 70              ; Max distance for a point to be considered part of the same line
gap_threshold: 150                  ; Maximum allowed gap between points
line_minimum_frame_range: 6         ; Minimum frame range a line must span to exclude flash detections
line_distance_const: 4              ; Constant affecting average point distance's impact on line quality.
point_ratio_threshold: 0.7          ; Ratio of points near a line needed before seeking another line.
max_lines: 5                        ; Maximum number of lines which are allowed to be found on the image



[MeteorDetection]

ff_min_stars: 20                    ; Minimum number of stars required in order to run the detection

; Binning (only supported for videos, images, and vid files, but no FF files!)
; -------
; Bin images before detection (has to be a factor of 2, e.g. 2, 4, 8, etc.). The X, Y coordinates in 
; detections will be rescaled to the original size. 1 = do not bin.
detection_binning_factor: 1 

; The image can be binned by either averaging ('avg') or summing ('sum') pixel intensities in the bin window.
; Note that the output image data type is uint16, so be careful of integer overflows when using "sum" method!
detection_binning_method: avg

; Thresholding and KHT parameters
; -------------------------------
k1: 3.5                             ; Weight for stddev in thresholding for faint meteor detection
j1: 12                              ; Absolute levels above average in thresholding for faint meteor detection 
max_white_ratio: 0.05               ; Maximum ratio of white to all pixels on a thresholded image
                                    ;   (used to avoid searching on very messed up images)
time_window_size: 64                ; Size of the time window which will be slided over the time axis 
time_slide: 32                      ; Subdivision size of the time axis
                                    ;   (256 will be divided into 256/time_slide parts)
max_lines_det: 30                   ; Maximum number of lines to be found on the time segment with KHT
line_min_dist: 50                   ; Minimum Frechet distance to merge KHT lines in Cartesian space
                                    ;   (used for merging similar lines after KHT)
stripe_width: 28                    ; Stripe width around the line for centroiding and photometry.

kht_build_dir: build                ; Directory where binaries are built
kht_binary_name: kht_module         ; Name of the KHT binary
kht_binary_extension: so            ; Extension of the KHT binary


; 3D matched filter parameters
; ----------------------------
max_points_det: 500                 ; Maximum number of points during 3D line search in faint meteor detection
                                    ;   (used to minimize runtime)


distance_threshold_det: 5
gap_threshold_det: 50               ; Maximum allowed gap between points in pixels, rescaled to 720x576
                                    ;   (if > 100, it will be divided by subsampling_size^2 to preserve
                                    ;   compatibility with older config files)
min_pixels_det: 10                  ; Minimum number of pixels in a strip
line_minimum_frame_range_det: 4     ; Minimum number of frames per one detection
line_distance_const_det: 4          ; Constant that determines the influence of average point distance on the
                                    ;   line quality
max_time_det: 7                     ; Maximum time in seconds for which line finding algorithm can run


; Postprocessing parameters
; -------------------------
vect_angle_thresh: 20               ; Angle similarity between 2 lines in a stripe to be merged
frame_extension: 10                 ; How many frames to check during centroiding before and after the
                                    ;   initially determined frame range


; Centroiding
; ------------
centroids_max_deviation: 2          ; Maximum deviation of a centroid point from a LSQ fitted line
                                    ;   (if above max, it will be rejected)
centroids_max_distance: 30          ; Maximum distance in pixels between centroids
                                    ;   (used for filtering spurious centroids)


; Angular velocity filter
ang_vel_min: 2.0    ; deg/s
ang_vel_max: 51.0   ; deg/s

; Filtering by intensity
; By default the peak of the meteor should be at least 16x brighter than the background. This is the 
; multiplier that scales this number (1.0 = 16x). Disabled if the ML filter is turned on.
min_patch_intensity_multiplier: 0.0

; Detection filtering by machine learning. This was only optimized on moderate field of view images and
; IMX291 and IMX307 data. Disable by setting to -1. The recommended threshold is 0.85. This will disable 
; the min_patch_intensity_multiplier filtering method.
ml_filter: 0.85



[StarExtraction]

; Extract stars
; -------------
max_global_intensity: 140           ; Maximum mean intensity of an image before it is discarded as too bright
border: 15                          ; Apply a mask on the detections by removing all that are too close to the
                                    ;   given image border (in pixels)
neighborhood_size: 10               ; Size of the neighbourhood for the maximum search (in pixels)
intensity_threshold: 18             ; A threshold for cutting the detections which are too faint (0-255)
max_stars: 400                      ; An upper limit on number of stars before the PSF fitting
                                    ;   (more than that would take too long to process)


; PSF fit and filtering
; ---------------------
segment_radius: 4                   ; Radius (in pixels) of image segment around the detected star on which
                                    ;   to perform the fit
roundness_threshold: 0.5            ; Minimum ratio of 2D Gaussian sigma X and sigma Y to be taken as a stars
                                    ;   (hot pixels are narrow, while stars are round)
max_feature_ratio: 0.8              ; Maximum ratio between 2 sigma of the star and the image segment area



[Calibration]

use_flat: false                     ; True - use flat for calibration, false - do not use flat
flat_file: flat.bmp                 ; Name of the flat field file
flat_min_imgs: 30                   ; Minimum number of FF images for making a flat


; Star catalog
; ------------
star_catalog_path: Catalogs                     ; Name of the folder where the star catalog are kept
star_catalog_file: gaia_dr2_mag_11.5.npy        ; Catalog file name (GAIA DR2 by default)

;star_catalog_band_ratios: 0.1,0.32,0.23,0.35   ; Ratio of B, V, R, I bands
                                                ;   use this only for the STARS9TH_VBVRI.txt catalog


; Platepar
; --------
; The default name of the PlatePar file (DO NOT PUT A FULL PATH HERE, just the name)
; The operational platepar file is always assumed to be in the same directory as the config file
platepar_name: platepar_cmn2010.cal 

; Name of the JSON file with recalibrated platepars for constant intervals of FF files
platepars_flux_recalibrated_name: platepars_flux_recalibrated.json

; Name of the JSON file with recalibrated platepars for every FF file
platepars_recalibrated_name: platepars_all_recalibrated.json

platepar_remote_name: platepar_latest.cal       ; Name of the new platepar file on the server
remote_platepar_dir: platepars                  ; Name of the directory on the server which contains platepars


; Auto recalibration
; -----------
catalog_mag_limit: 5.2          ; The limiting magnitude of the used stars, used for filtering out catalog
                                ;   stars which are fainter then the system can detect
calstars_files_N: 400           ; How many calstars FF files to evaluate 
calstars_min_stars: 1000        ; Minimum number of stars to use
min_matched_stars: 20           ; A minimum number of stars on the image for accepting the image
dist_check_threshold: 0.33      ; If the average distance (pixels) between catalog and image stars is below
                                ;   this threshold, astrometry recalibration will not run but the existing
                                ;   calibration will be used
dist_check_quick_threshold: 0.4 ; If the averge distance (pixels) is below this number, only a quick
                                ;   recalibration procedure will run



[Thumbnails]

thumb_bin:      4               ; Thumbnail binning
thumb_stack:    5               ; How many images will be stacked per each thumbnail
thumb_n_width: 10               ; Number of thumbnails in each row



[Stack]

stack_mask: false               ; Whether to apply the mask to stack or not



[Timelapse]

timelapse_generate_captured: true   ; Automatically generate a timelapse using all FF files




[Colors]

shower_color_map: gist_ncar     ; color palette to use for various charts -can be any matplotlib color scheme
                                ; other options are gist_ncar, rainbow, gist_rainbow, inferno 

